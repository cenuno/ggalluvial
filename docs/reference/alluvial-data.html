<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Check for alluvial structure and convert between alluvial formats — alluvial-data • ggalluvial</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">ggalluvial</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ggalluvial.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Check for alluvial structure and convert between alluvial formats</h1>
    </div>

    
    <p>Alluvial diagrams consist of multiple horizontally-distributed columns (axes)
representing factor variables, vertical divisions (strata) of these axes
representing these variables' values; and splines (alluvial flows) connecting
vertical subdivisions (lodes) within strata of adjacent axes representing
subsets or amounts of observations that take the corresponding values of the
corresponding variables. This function checks a data frame for either of two
types of alluvial structure:</p><ul>
<li><p>One row per <strong>lode</strong>, wherein each row encodes a subset or
        amount of observations having a specific profile of axis values, a
        <code>key</code> field encodes the axis, a <code>value</code> field encodes the
        value within each axis, and a <code>id</code> column identifies multiple
        lodes corresponding to the same subset or amount of observations.</p></li>
<li><p>One row per <strong>alluvium</strong>, wherein each row encodes a subset or
        amount of observations having a specific profile of axis values and a
        set <code>axes</code> of fields encodes its values at each axis variable.</p></li>
</ul><p>If no arguments are assigned to any of these parameters, then
<code>is_alluvial</code> will default to <code>is_alluvial_alluvia</code> and assume that
all fields in <code>data</code> (other than <code>weight</code>, if given) are to be
treated as axes.</p>
    

    <pre class="usage"><span class='fu'>is_alluvial</span>(<span class='no'>data</span>, <span class='no'>...</span>, <span class='kw'>logical</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>silent</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>is_alluvial_lodes</span>(<span class='no'>data</span>, <span class='no'>key</span>, <span class='no'>value</span>, <span class='no'>id</span>, <span class='kw'>weight</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>logical</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>silent</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>is_alluvial_alluvia</span>(<span class='no'>data</span>, <span class='kw'>axes</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>weight</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>logical</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>silent</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>to_lodes</span>(<span class='no'>data</span>, <span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>"x"</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"stratum"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"alluvium"</span>, <span class='no'>axes</span>,
  <span class='kw'>keep</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>to_alluvia</span>(<span class='no'>data</span>, <span class='no'>key</span>, <span class='no'>value</span>, <span class='no'>id</span>, <span class='kw'>distill</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A data frame.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional parameters used to determine method and passed
thereto. All or none of <code>key</code>, <code>value</code>, and <code>id</code>, or else
optionally <code>axes</code>, and (in either case) optionally <code>weight</code>.</p></td>
    </tr>
    <tr>
      <th>logical</th>
      <td><p>Whether to return a logical value or a character string
indicating the type of alluvial structure ("none", "lodes", or "alluvia")</p></td>
    </tr>
    <tr>
      <th>silent</th>
      <td><p>Whether to print warning messages.</p></td>
    </tr>
    <tr>
      <th>key, value, id</th>
      <td><p>Numeric or character; the fields of <code>data</code>
corresponding to the axis (variable), stratum (value), and alluvium
(identifying) variables.</p></td>
    </tr>
    <tr>
      <th>weight</th>
      <td><p>Optional numeric or character; the fields of <code>data</code>
corresponding to alluvium or lode weights (heights when plotted).</p></td>
    </tr>
    <tr>
      <th>axes</th>
      <td><p>Numeric or character vector; the field(s) of <code>data</code>
corresponding to the axi(e)s (variable(s)).</p></td>
    </tr>
    <tr>
      <th>keep</th>
      <td><p>A numeric or character vector indicating which variables among
those passed to <code>axes</code> to merge into the reshapen data by <code>id</code>. 
Alternatively, a logical value indicating whether to merge all 
(<code>TRUE</code>) or none (<code>FALSE</code>) of these variables.</p></td>
    </tr>
    <tr>
      <th>distill</th>
      <td><p>A logical value indicating whether to include variables, other
than those passed to <code>key</code> and <code>value</code>, that vary within values 
of <code>id</code>. Alternatively, the name of a function to be used to distill
each such variable to a single value. Acceptable function names include 
<code>"first"</code>, <code>"last"</code>, and <code>"most"</code> (which returns the modal
value; assumed if <code>TRUE</code>).</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>to_lodes</code> takes a data frame with several designated variables to be 
used as axes in an alluvial diagram, and reshapes the data frame so that the 
axis variable names constitute a new factor variable and their values 
comprise another. Other variables' values will be repeated, and a 
row-grouping variable can be introduced. This function invokes 
<code><a href='http://www.rdocumentation.org/packages/tidyr/topics/deprecated-se'>gather_</a></code>.
    <code>to_alluvia</code> takes a data frame with axis and axis value variables to be
used in an alluvial diagram, and reshape the data frame so that the axes
constitute separate variables whose values are given by the value variable.
This function invokes <code><a href='http://www.rdocumentation.org/packages/tidyr/topics/deprecated-se'>spread_</a></code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Titanic data in alluvia format</span>
<span class='no'>titanic_alluvia</span> <span class='kw'>&lt;-</span> <span class='fu'>as.data.frame</span>(<span class='no'>Titanic</span>)
<span class='fu'>head</span>(<span class='no'>titanic_alluvia</span>)</div><div class='output co'>#&gt;   Class    Sex   Age Survived Freq
#&gt; 1   1st   Male Child       No    0
#&gt; 2   2nd   Male Child       No    0
#&gt; 3   3rd   Male Child       No   35
#&gt; 4  Crew   Male Child       No    0
#&gt; 5   1st Female Child       No    0
#&gt; 6   2nd Female Child       No    0</div><div class='input'><span class='fu'>is_alluvial</span>(<span class='no'>titanic_alluvia</span>,
            <span class='kw'>weight</span> <span class='kw'>=</span> <span class='st'>"Freq"</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='co'># Titanic data in lodes format</span>
<span class='no'>titanic_lodes</span> <span class='kw'>&lt;-</span> <span class='fu'>to_lodes</span>(<span class='no'>titanic_alluvia</span>,
                          <span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>"x"</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"stratum"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"alluvium"</span>,
                          <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>4</span>)
<span class='fu'>head</span>(<span class='no'>titanic_lodes</span>)</div><div class='output co'>#&gt;   Freq alluvium     x stratum
#&gt; 1    0        1 Class     1st
#&gt; 2    0        2 Class     2nd
#&gt; 3   35        3 Class     3rd
#&gt; 4    0        4 Class    Crew
#&gt; 5    0        5 Class     1st
#&gt; 6    0        6 Class     2nd</div><div class='input'><span class='fu'>is_alluvial</span>(<span class='no'>titanic_lodes</span>,
            <span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>"x"</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"stratum"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"alluvium"</span>,
            <span class='kw'>weight</span> <span class='kw'>=</span> <span class='st'>"Freq"</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='co'># again in lodes format, this time keeping 'Class' as a variable</span>
<span class='no'>titanic_lodes2</span> <span class='kw'>&lt;-</span> <span class='fu'>to_lodes</span>(<span class='no'>titanic_alluvia</span>,
                           <span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>"variable"</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"value"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"passenger"</span>,
                           <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>3</span>, <span class='kw'>keep</span> <span class='kw'>=</span> <span class='st'>"Class"</span>)
<span class='fu'>head</span>(<span class='no'>titanic_lodes2</span>)</div><div class='output co'>#&gt;   passenger Survived Freq variable value Class
#&gt; 1         1       No    0    Class   1st   1st
#&gt; 2         1       No    0      Sex  Male   1st
#&gt; 3         1       No    0      Age Child   1st
#&gt; 4         2       No    0    Class   2nd   2nd
#&gt; 5         2       No    0      Sex  Male   2nd
#&gt; 6         2       No    0      Age Child   2nd</div><div class='input'><span class='fu'>is_alluvial</span>(<span class='no'>titanic_lodes2</span>,
            <span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>"variable"</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"value"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"passenger"</span>,
            <span class='kw'>weight</span> <span class='kw'>=</span> <span class='st'>"Freq"</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># curriculum data in lodes format</span>
<span class='fu'>data</span>(<span class='no'>majors</span>)
<span class='fu'>head</span>(<span class='no'>majors</span>)</div><div class='output co'>#&gt;   student semester curriculum
#&gt; 1       1    CURR1   Painting
#&gt; 2       2    CURR1   Painting
#&gt; 3       6    CURR1   Sculpure
#&gt; 4       8    CURR1   Painting
#&gt; 5       9    CURR1   Sculpure
#&gt; 6      10    CURR1   Painting</div><div class='input'><span class='fu'>is_alluvial</span>(<span class='no'>majors</span>,
            <span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>"semester"</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"curriculum"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"student"</span>,
            <span class='kw'>logical</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; [1] "lodes"</div><div class='input'><span class='co'># curriculum data in alluvia format</span>
<span class='no'>majors_alluvia</span> <span class='kw'>&lt;-</span> <span class='fu'>to_alluvia</span>(
  <span class='no'>majors</span>,
  <span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>"semester"</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"curriculum"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"student"</span>
)
<span class='fu'>head</span>(<span class='no'>majors_alluvia</span>)</div><div class='output co'>#&gt;   student    CURR1       CURR3       CURR5    CURR7    CURR9   CURR11   CURR13
#&gt; 1       1 Painting    Painting    Painting Painting Painting Painting Painting
#&gt; 2       2 Painting    Painting    Painting Painting Painting Painting     &lt;NA&gt;
#&gt; 3       6 Sculpure    Sculpure    Painting Painting Painting Painting Painting
#&gt; 4       8 Painting    Painting    Painting Painting     &lt;NA&gt; Painting Painting
#&gt; 5       9 Sculpure Art History Art History Painting Painting Painting Painting
#&gt; 6      10 Painting    Painting    Painting Painting Painting Painting     &lt;NA&gt;
#&gt;     CURR15
#&gt; 1 Painting
#&gt; 2     &lt;NA&gt;
#&gt; 3 Painting
#&gt; 4 Painting
#&gt; 5 Painting
#&gt; 6     &lt;NA&gt;</div><div class='input'><span class='fu'>is_alluvial</span>(<span class='no'>majors_alluvia</span>,
            <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>2</span>:<span class='fl'>9</span>,
            <span class='kw'>logical</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Missing alluvia for some stratum combinations.</span></div><div class='output co'>#&gt; [1] "alluvia"</div><div class='input'>
<span class='co'># distill variables that vary within 'id' values</span>
<span class='fu'>set.seed</span>(<span class='fl'>1</span>)
<span class='no'>majors</span>$<span class='no'>hypo_grade</span> <span class='kw'>&lt;-</span> <span class='no'>LETTERS</span>[<span class='fu'>sample</span>(<span class='fl'>5</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fu'>nrow</span>(<span class='no'>majors</span>), <span class='kw'>replace</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)]
<span class='no'>majors_alluvia2</span> <span class='kw'>&lt;-</span> <span class='fu'>to_alluvia</span>(
  <span class='no'>majors</span>,
  <span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>"semester"</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"curriculum"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"student"</span>,
  <span class='kw'>distill</span> <span class='kw'>=</span> <span class='st'>"most"</span>
)</div><div class='output co'>#&gt; <span class='message'>Distilled variables: hypo_grade</span></div><div class='input'><span class='fu'>head</span>(<span class='no'>majors_alluvia2</span>)</div><div class='output co'>#&gt;   student hypo_grade    CURR1       CURR3       CURR5    CURR7    CURR9
#&gt; 1       1          B Painting    Painting    Painting Painting Painting
#&gt; 2       2          B Painting    Painting    Painting Painting Painting
#&gt; 3       6          C Sculpure    Sculpure    Painting Painting Painting
#&gt; 4       8          B Painting    Painting    Painting Painting     &lt;NA&gt;
#&gt; 5       9          B Sculpure Art History Art History Painting Painting
#&gt; 6      10          B Painting    Painting    Painting Painting Painting
#&gt;     CURR11   CURR13   CURR15
#&gt; 1 Painting Painting Painting
#&gt; 2 Painting     &lt;NA&gt;     &lt;NA&gt;
#&gt; 3 Painting Painting Painting
#&gt; 4 Painting Painting Painting
#&gt; 5 Painting Painting Painting
#&gt; 6 Painting     &lt;NA&gt;     &lt;NA&gt;</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Jason Cory Brunson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
